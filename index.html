<!DOCTYPE html>
<html lang="fa" dir="rtl" class="no-js">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ویرایشگر کد پیشرفته | پشتیبانی از HTML, CSS, JS, TS, JSX | اجرای آنلاین کد</title>
    <meta name="description" content="ویرایشگر کد آنلاین حرفه‌ای با قابلیت‌های پیشرفته مانند ذخیره‌سازی ابری، دیباگینگ، اجرای زنده، پشتیبانی از فریمورک‌ها و کتابخانه‌های مدرن">
    <meta name="keywords" content="ویرایشگر کد, اجرای آنلاین, جاوااسکریپت, تایپ‌اسکریپت, ری‌اکت, ویو, انگولار, ادیتور آنلاین, دیباگر">
    <meta name="author" content="Advanced Code Editor Team">
    <meta name="theme-color" content="#2563eb" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1e40af" media="(prefers-color-scheme: dark)">
    <meta name="robots" content="index, follow">
    
    <!-- Favicon (Multi-platform with SVG + PNG fallback) -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    
    <!-- Critical CSS Inlined (Optimized) -->
    <style id="critical-css">
        :root {
            --primary-500: #3b82f6; --primary-600: #2563eb;
            --surface-0: #ffffff; --surface-100: #f1f5f9; --surface-800: #1e293b;
            --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
            --radius-md: 0.375rem; --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --transition-colors: color 0.15s, background-color 0.15s;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --surface-0: #020617; --surface-100: #1e293b; --surface-800: #f1f5f9;
            }
        }
        
        * { box-sizing: border-box; margin: 0; }
        html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
        body { font-family: system-ui, 'Vazirmatn', sans-serif; line-height: 1.5; color: var(--surface-800); background: var(--surface-0); min-height: 100vh; display: flex; flex-direction: column; }
        .no-js body { opacity: 1 !important; }
    </style>
    
    <!-- Preload Critical Resources with Fallback -->
    <link rel="preload" href="/fonts/Vazirmatn-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/Vazirmatn-Regular.woff" as="font" type="font/woff" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- Deferred CSS Loading -->
    <link rel="stylesheet" href="/css/main.min.css" media="print" onload="this.media='all'" id="main-css">
    <link rel="stylesheet" href="/css/editor.min.css" media="print" onload="this.media='all'" id="editor-css">
    
    <!-- Noscript fallback -->
    <noscript>
        <link rel="stylesheet" href="/css/main.min.css">
        <link rel="stylesheet" href="/css/editor.min.css">
        <style>.no-js { display: none !important; }</style>
    </noscript>
    
    <!-- Progressive Enhancement -->
    <script>
        // Remove no-js class
        document.documentElement.classList.remove('no-js');
        document.documentElement.classList.add('js');
        
        // CSS loading fallback
        function loadCSS(href, id) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href;
            if (id) link.id = id;
            document.head.appendChild(link);
            return new Promise((resolve, reject) => {
                link.onload = resolve;
                link.onerror = () => {
                    document.getElementById('loadingText').textContent = 'خطا در بارگذاری منابع. لطفاً اتصال اینترنت را بررسی کنید.';
                    reject();
                };
            });
        }
        
        // Load critical CSS if not loaded
        if (!document.getElementById('main-css')) {
            loadCSS('/css/main.min.css', 'main-css').catch(console.error);
        }
    </script>
</head>
<body>
    <!-- App Shell with ARIA landmarks -->
    <div class="app-shell" role="application" aria-labelledby="app-title">
        <!-- App Header -->
        <header class="app-header" role="banner" aria-label="هدر برنامه">
            <div class="header-brand">
                <svg class="logo-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M13 3H7a4 4 0 0 0-4 4v10a4 4 0 0 0 4 4h10a4 4 0 0 0 4-4v-7h-2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h6V3zm5 0v4h-2V5h-3V3h5z"/>
                </svg>
                <h1 id="app-title" class="header-title">ویرایشگر کد پیشرفته</h1>
                <span class="header-badge">نسخه پرو</span>
            </div>
            
            <div class="header-actions">
                <div class="dropdown" data-dropdown>
                    <button class="btn btn-icon" data-dropdown-toggle aria-haspopup="true" aria-expanded="false" aria-label="منوی پروژه">
                        <svg width="20" height="20" fill="none" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.75 5.75h14.5m-14.5 6h14.5m-14.5 6h14.5"/>
                        </svg>
                        <span class="sr-only">منوی پروژه</span>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="project-menu">
                        <li role="none"><button class="dropdown-item" role="menuitem">پروژه جدید</button></li>
                        <li role="none"><button class="dropdown-item" role="menuitem">باز کردن پروژه</button></li>
                        <li role="none"><button class="dropdown-item" role="menuitem">ذخیره پروژه</button></li>
                        <li role="separator"></li>
                        <li role="none"><button class="dropdown-item" role="menuitem">صادر کردن</button></li>
                    </ul>
                </div>
                
                <button class="btn btn-icon" id="toggleTheme" aria-label="تغییر تم" data-theme-toggle>
                    <svg class="icon-light" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM1 11h3v2H1v-2zm19 0h3v2h-3v-2z"/>
                    </svg>
                    <svg class="icon-dark" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1-8.313-12.454z"/>
                    </svg>
                    <span class="sr-only">تغییر تم</span>
                </button>
                
                <button class="btn btn-icon" id="fullscreenBtn" aria-label="حالت تمام صفحه">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.25 4.75h4.5v4.5m-10.5-4.5h-4.5v4.5m4.5 10.5h-4.5v-4.5m10.5 4.5h4.5v-4.5"/>
                    </svg>
                    <span class="sr-only">حالت تمام صفحه</span>
                </button>
                
                <button class="btn btn-primary" id="runBtn" aria-label="اجرای کد">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M18.25 12L5.75 5.75V18.25L18.25 12z"/>
                    </svg>
                    <span class="btn-text">اجرا</span>
                </button>
            </div>
        </header>
        
        <!-- Main App Content -->
        <main class="app-content" role="main">
            <!-- Editor Tabs -->
            <div class="editor-tabs" role="tablist" aria-label="تب‌های ویرایشگر">
                <button class="editor-tab active" role="tab" aria-selected="true" aria-controls="html-editor-panel" id="html-tab" tabindex="0">
                    <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75l-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z"/>
                    </svg>
                    <span>HTML</span>
                </button>
                <button class="editor-tab" role="tab" aria-selected="false" aria-controls="css-editor-panel" id="css-tab" tabindex="-1">
                    <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M1.5 0h21l-1.91 21.563L11.977 24l-8.565-2.438L1.5 0zm17.09 4.413L5.41 4.41l.213 2.622 10.125.002-.255 2.716h-6.64l.24 2.573h6.182l-.366 3.523-2.91.804-2.956-.81-.188-2.11h-2.61l.29 3.855L12 19.288l5.373-1.53L18.59 4.414z"/>
                    </svg>
                    <span>CSS</span>
                </button>
                <button class="editor-tab" role="tab" aria-selected="false" aria-controls="js-editor-panel" id="js-tab" tabindex="-1">
                    <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"/>
                    </svg>
                    <span>JavaScript</span>
                </button>
                <button class="editor-tab" role="tab" aria-selected="false" aria-controls="console-panel" id="console-tab" tabindex="-1">
                    <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M13 8.5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1 0-1h5a.5.5 0 0 1 .5.5zM13 11a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1 0-1h5A.5.5 0 0 1 13 11zm3 2.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5z"/>
                        <path fill="currentColor" d="M14 1a1 1 0 0 1 1 1v1h3a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h3V2a1 1 0 0 1 1-1h4zM6 4v14h12V4H6z"/>
                    </svg>
                    <span>کنسول</span>
                </button>
                <div class="editor-tabs-spacer"></div>
                <button class="editor-tab editor-tab-add" aria-label="افزودن تب جدید">
                    <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M12 4a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6V5a1 1 0 0 1 1-1z"/>
                    </svg>
                    <span class="sr-only">افزودن تب جدید</span>
                </button>
            </div>
            
            <!-- Editor Panels -->
            <div class="editor-panels">
                <!-- HTML Editor -->
                <div class="editor-panel active" role="tabpanel" id="html-editor-panel" aria-labelledby="html-tab" tabindex="0">
                    <div class="editor-container" id="html-editor"></div>
                </div>
                
                <!-- CSS Editor -->
                <div class="editor-panel" role="tabpanel" id="css-editor-panel" aria-labelledby="css-tab" tabindex="0" hidden>
                    <div class="editor-container" id="css-editor"></div>
                </div>
                
                <!-- JS Editor -->
                <div class="editor-panel" role="tabpanel" id="js-editor-panel" aria-labelledby="js-tab" tabindex="0" hidden>
                    <div class="editor-container" id="js-editor"></div>
                </div>
                
                <!-- Console Panel -->
                <div class="editor-panel" role="tabpanel" id="console-panel" aria-labelledby="console-tab" tabindex="0" hidden>
                    <div class="console-container">
                        <div class="console-toolbar">
                            <button class="btn btn-sm" id="clearConsoleBtn" aria-label="پاک کردن کنسول">
                                <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                    <path fill="currentColor" d="M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                                پاک کردن
                            </button>
                            <button class="btn btn-sm" id="exportConsoleBtn" aria-label="صدور لاگ کنسول">
                                <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                    <path fill="currentColor" d="M19 9h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                                صدور
                            </button>
                        </div>
                        <div class="console-output" id="consoleOutput" role="log"></div>
                    </div>
                </div>
            </div>
            
            <!-- Preview Panel -->
            <div class="preview-panel">
                <div class="preview-toolbar">
                    <div class="preview-device-selector">
                        <button class="btn btn-sm btn-icon" data-device="desktop" aria-label="دسکتاپ" aria-pressed="true">
                            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path fill="currentColor" d="M4 2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-6v2h2a1 1 0 0 1 0 2H8a1 1 0 0 1 0-2h2v-2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2v12h16V4H4z"/>
                            </svg>
                            <span class="sr-only">دسکتاپ</span>
                        </button>
                        <button class="btn btn-sm btn-icon" data-device="tablet" aria-label="تبلت" aria-pressed="false">
                            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path fill="currentColor" d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2v16h12V4H6zm5 15a1 1 0 1 1 2 0 1 1 0 0 1-2 0z"/>
                            </svg>
                            <span class="sr-only">تبلت</span>
                        </button>
                        <button class="btn btn-sm btn-icon" data-device="mobile" aria-label="موبایل" aria-pressed="false">
                            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path fill="currentColor" d="M7 2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2v16h10V4H7zm5 15a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                            </svg>
                            <span class="sr-only">موبایل</span>
                        </button>
                    </div>
                    
                    <button class="btn btn-sm btn-icon" id="refreshPreviewBtn" aria-label="بازنشانی پیش‌نمایش">
                        <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path fill="currentColor" d="M10.11 17.5c1.254 0 2.51-.376 3.54-1.13a6 6 0 0 0 1.13-1.13l1.42 1.42a7.975 7.975 0 0 1-1.9 1.62 8.42 8.42 0 0 1-5.19 1.59c-2.22 0-4.43-.85-6.14-2.56a8.56 8.56 0 0 1-2.56-6.14c0-2.22.85-4.44 2.56-6.14a8.77 8.77 0 0 1 6.14-2.56c2.22 0 4.44.85 6.14 2.56a8.56 8.56 0 0 1 2.56 6.14h-2a6.5 6.5 0 0 0-1.94-4.62 6.77 6.77 0 0 0-4.66-1.98c-1.82 0-3.62.69-4.96 2.03a6.93 6.93 0 0 0-2.04 4.97c0 1.82.7 3.64 2.04 4.97a6.93 6.93 0 0 0 4.96 2.03zm11.39-5.5h2v6h-6v-2h2.6l-3.46-3.46 1.42-1.41L21.5 17v-4.5z"/>
                        </svg>
                        <span class="sr-only">بازنشانی پیش‌نمایش</span>
                    </button>
                    
                    <button class="btn btn-sm btn-icon" id="openInNewTabBtn" aria-label="باز کردن در تب جدید">
                        <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path fill="currentColor" d="M18 19H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5v2H6v10h12v-5h2v5a2 2 0 0 1-2 2zm-3-8V8h-2v3H8v2h5v3h2v-3h3v-2h-3z"/>
                        </svg>
                        <span class="sr-only">باز کردن در تب جدید</span>
                    </button>
                </div>
                
                <iframe class="preview-frame" id="previewFrame" title="پیش‌نمایش کد" sandbox="allow-scripts allow-modals allow-forms allow-popups" loading="lazy"></iframe>
            </div>
        </main>
        
        <!-- Status Bar -->
        <footer class="status-bar" role="contentinfo" aria-label="وضعیت برنامه">
            <div class="status-indicator" id="statusIndicator">
                <span class="status-dot"></span>
                <span id="statusMessage">آماده</span>
            </div>
            
            <div class="status-actions">
                <button class="btn btn-sm btn-icon" id="toggleConsoleBtn" aria-label="نمایش کنسول">
                    <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M13 8.5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1 0-1h5a.5.5 0 0 1 .5.5zM13 11a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1 0-1h5A.5.5 0 0 1 13 11zm3 2.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5z"/>
                        <path fill="currentColor" d="M14 1a1 1 0 0 1 1 1v1h3a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h3V2a1 1 0 0 1 1-1h4zM6 4v14h12V4H6z"/>
                    </svg>
                    <span class="sr-only">نمایش کنسول</span>
                </button>
                
                <div class="status-position" id="cursorPosition">
                    خط ۱, ستون ۱
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer" aria-live="assertive"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" aria-busy="true" aria-live="polite" hidden>
        <div class="loading-spinner">
            <svg viewBox="0 0 50 50" aria-hidden="true" focusable="false">
                <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="5" stroke-dasharray="31.415, 31.415" stroke-linecap="round">
                    <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
                </circle>
            </svg>
        </div>
        <div class="loading-text" id="loadingText">در حال بارگذاری...</div>
    </div>
    
    <!-- Offline Warning -->
    <div class="offline-warning" id="offlineWarning" hidden>
        <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <span>حالت آفلاین - برخی قابلیت‌ها ممکن است محدود باشند</span>
    </div>
    
    <!-- JavaScript Modules -->
    <script type="module">
        // Feature detection
        const supportedFeatures = {
            modules: 'noModule' in HTMLScriptElement.prototype,
            serviceWorker: 'serviceWorker' in navigator,
            indexedDB: 'indexedDB' in window
        };
        
        if (!supportedFeatures.modules) {
            showError('مرورگر شما از ماژول‌های ES پشتیبانی نمی‌کند. لطفاً از آخرین نسخه مرورگر استفاده کنید.');
        }
        
        // Load the app
        import App from '/js/app.js';
        
        // Initialize the app
        async function initApp() {
            try {
                // Show loading state
                document.getElementById('loadingOverlay').hidden = false;
                
                // Check network status
                if (!navigator.onLine) {
                    document.getElementById('offlineWarning').hidden = false;
                }
                
                // Initialize app
                const app = new App({
                    container: document.querySelector('.app-shell'),
                    editors: {
                        html: { element: document.getElementById('html-editor') },
                        css: { element: document.getElementById('css-editor') },
                        js: { element: document.getElementById('js-editor') }
                    },
                    preview: {
                        frame: document.getElementById('previewFrame'),
                        console: document.getElementById('consoleOutput')
                    }
                });
                
                await app.init();
                
                // Hide loading overlay
                document.getElementById('loadingOverlay').hidden = true;
                
                // Set app as loaded
                document.documentElement.classList.add('app-loaded');
                
            } catch (error) {
                console.error('App initialization failed:', error);
                showError('خطا در بارگذاری برنامه. لطفاً صفحه را بازنشانی کنید.');
            }
        }
        
        // Helper functions
        function showError(message) {
            const loadingText = document.getElementById('loadingText');
            loadingText.textContent = message;
            loadingText.style.color = 'var(--danger)';
        }
        
        // Network status detection
        window.addEventListener('online', () => {
            document.getElementById('offlineWarning').hidden = true;
        });
        
        window.addEventListener('offline', () => {
            document.getElementById('offlineWarning').hidden = false;
        });
        
        // Start the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    
    <!-- Fallback for browsers without module support -->
    <script nomodule>
        document.getElementById('loadingOverlay').hidden = false;
        document.getElementById('loadingText').textContent = 'مرورگر شما از ماژول‌های ES پشتیبانی نمی‌کند. لطفاً از آخرین نسخه مرورگر استفاده کنید.';
        document.getElementById('loadingText').style.color = 'var(--danger)';
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful');
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
